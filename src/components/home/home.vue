<template>
  <scroll class="home-container">
    <div class="home">
      <div class="panels row">
          <div class="panel-l col-lg-6 col-md-12 col-xs-12">
          <div class="title xiazuan">
            能源绩效
          </div>
          <div class="panel row">
            <div class="col-md-6 col-xs-12">
              <div class="panel-item">
                <div class="row xiazuan">产值综合能耗</div>
                <div class="row">
                  <span class="row-item"><span class="big">0.0321</span>&nbsp;&nbsp;吨标煤/万元</span>
                </div>
                <div class="row">
                  <span class="row-item">同比<span class="down">&nbsp;<i class="fa fa-long-arrow-down"></i>&nbsp;53.94%</span></span>
                  <span class="row-item">&nbsp;环比<span class="down">&nbsp;<i class="fa fa-long-arrow-down"></i>&nbsp;23.94%</span></span>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-xs-12">
              <div class="panel-item">
                <div class="row xiazuan">单车能耗费用</div>
                <div class="row">
                  <span class="row-item"><span class="big">1665</span>&nbsp;&nbsp;元/辆</span>
                </div>
                <div class="row">
                  <span class="row-item">同比<span class="down">&nbsp;<i class="fa fa-long-arrow-down"></i>&nbsp;58.94%</span></span>
                  <span class="row-item">&nbsp;环比<span class="up">&nbsp;<i class="fa fa-long-arrow-up"></i>&nbsp;2.96%</span></span>
                </div>
              </div>
            </div>
          </div>
          <div class="panel row">
            <div class="col-md-6 col-xs-12">
              <div class="panel-item">
                <div class="row xiazuan">碳排放强度</div>
                <div class="row">
                  <span class="row-item"><span class="big">101.16</span>&nbsp;&nbsp;吨标煤/辆</span>
                </div>
                <div class="row">
                  <span class="row-item">同比<span class="down">&nbsp;<i class="fa fa-long-arrow-down"></i>&nbsp;7.94%</span></span>
                  <span class="row-item">&nbsp;环比<span class="down">&nbsp;<i class="fa fa-long-arrow-down"></i>&nbsp;58.94%</span></span>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-xs-12">
              <div class="panel-item">
                <div class="row xiazuan">单车碳排放量</div>
                <div class="row">
                  <span class="row-item"><span class="big">101.58</span>&nbsp;&nbsp;KGCO2/辆</span>
                </div>
                <div class="row">
                  <span class="row-item">同比<span class="up">&nbsp;<i class="fa fa-long-arrow-up"></i>&nbsp;2.54%</span></span>
                  <span class="row-item">&nbsp;环比<span class="up">&nbsp;<i class="fa fa-long-arrow-up"></i>&nbsp;2.96%</span></span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="panel-r col-lg-6 col-md-12 col-xs-12">
          <div class="title xiazuan">
            能耗信息
          </div>
          <div class="panel row">
            <div class="col-md-4  col-xs-12">
              <div class="panel-item">
                <div class="row xiazuan">生成产量</div>
                <div class="row">
                  <span class="row-item"><span class="big">22.9788</span>&nbsp;&nbsp;万辆</span>
                </div>
                <div class="row">
                  <div class="row-item">同比<span class="down">&nbsp;<i class="fa fa-long-arrow-down"></i>&nbsp;212.2%</span></div>
                </div>
                <div class="row">
                  <div class="row-item">环比<span class="down">&nbsp;<i class="fa fa-long-arrow-down"></i>&nbsp;2.48%</span></div>
                </div>
              </div>
            </div>
            <div class="col-md-4  col-xs-12">
              <div class="panel-item">
                <div class="row xiazuan">能源用量</div>
                <div class="row">
                  <span class="row-item"><span class="big">10.3514</span>&nbsp;&nbsp;万吨标煤</span>
                </div>
                <div class="row">
                  <div class="row-item">同比<span class="down">&nbsp;<i class="fa fa-long-arrow-down"></i>&nbsp;20.28%</span></div>
                </div>
                <div class="row">
                  <div class="row-item">环比<span class="up">&nbsp;<i class="fa fa-long-arrow-up"></i>&nbsp;2.73%</span></div>
                </div>
              </div>
            </div>
            <div class="col-md-4  col-xs-12">
              <div class="panel-item">
                <div class="row xiazuan">能源费用</div>
                <div class="row">
                  <span class="row-item"><span class="big">37434.71</span>&nbsp;&nbsp;万元</span>
                </div>
                <div class="row">
                  <div class="row-item">同比<span class="down">&nbsp;<i class="fa fa-long-arrow-down"></i>&nbsp;17.68%</span></div>
                </div>
                <div class="row">
                  <div class="row-item">环比<span class="up">&nbsp;<i class="fa fa-long-arrow-up"></i>&nbsp;1.32%</span></div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel row">
            <div class="col-md-4 col-xs-12">
              <div class="panel-item">
                <div class="row">碳排放量</div>
                <div class="row">
                  <span class="row-item"><span class="big">33.30</span>&nbsp;&nbsp;吨CO2</span>
                </div>
                <div class="row">
                  <div class="row-item">同比<span class="down">&nbsp;<i class="fa fa-long-arrow-down"></i>&nbsp;56.2%</span></div>
                </div>
                <div class="row">
                  <div class="row-item">环比<span class="up">&nbsp;<i class="fa fa-long-arrow-up"></i>&nbsp;34.7%</span></div>
                </div>
              </div>
            </div>
            <div class="col-md-4 col-xs-12">
              <div class="panel-item">
                <div class="row">清洁能源</div>
                <div class="row">
                  <span class="row-item"><span class="big">4586</span>&nbsp;&nbsp;吨标煤</span>
                </div>
                <div class="row">
                  <div class="row-item">同比<span class="down">&nbsp;<i class="fa fa-long-arrow-down"></i>&nbsp;12.2%</span></div>
                </div>
                <div class="row">
                  <div class="row-item">环比<span class="up">&nbsp;<i class="fa fa-long-arrow-up"></i>&nbsp;6.7%</span></div>
                </div>
              </div>
            </div>
            <div class="col-md-4 col-xs-12">
              <div class="panel-item">
                <div class="row">光伏发电实时量</div>
                <div class="row">
                  <span class="row-item">
                    <span class="big">
                      <flip :data="flipData"></flip>
                    </span>&nbsp;&nbsp;千瓦时</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="real-time row">
        <div class="col-lg-6 col-md-12 col-xs-12">
          <div class="dosage" ref="dosage"></div>
        </div>
        <div class="col-lg-6 col-md-12 col-xs-12">
          <div class="cost" ref="cost"></div>
        </div>
      </div>
      <div class="chart row">
        <div class="col-lg-8 col-md-12 col-xs-12">
          <div class="energy" ref="energy"></div>
        </div>
        <div class="col-lg-4 col-md-12 col-xs-12">
          <div class="analyze" ref="analyze"></div>
        </div>
      </div>
    </div>
  </scroll>
</template>
<script>
import Scroll from 'base/scroll/scroll'
import Flip from 'base/flip/flip'
import echarts from 'echarts/lib/echarts'
import 'echarts/lib/chart/bar'
import 'echarts/lib/chart/pie'
import 'echarts/lib/chart/line'
import 'echarts/lib/component/tooltip'
import 'echarts/lib/component/title'
export default {
  components: {
    Scroll,
    Flip
  },
  data() {
    return {
      flipData: []
    }
  },
  created() {
    this.energyChart = {}
    this.analyzeChat = {}
    this.dosageChat = {}
    this.costChat = {}
  },
  methods: {
    makeEnergyChart() {
      // 基于准备好的dom，初始化echarts实例
      this.energyChart = echarts.init(this.$refs.energy)
      // 指定图表的配置项和数据
      const option = {
        title: {
          text: '能源用量与节能指标同比分析',
          x: 'center',
          textStyle: {
            color: '#0965bd'
          }
        },
        color: ['#23a9f6', '#095db1', '#ff6600', '#a9d051'],
        tooltip: {
          trigger: 'axis',
          axisPointer: {
            type: 'cross',
            crossStyle: {
              color: '#283b56'
            },
            label: {
              backgroundColor: '#283b56'
            }
          }
        },
        legend: {
          padding: [5, 0, 0, 0],
          bottom: 0,
          data: ['实际能源用量', '计划能源用量', '上年同期能源用量', '计划节能指标', '实际节能指标', '上年同期节能指标'],
          textStyle: {
            color: '#666'
          }
        },
        xAxis: [
          {
            type: 'category',
            data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],
            axisPointer: {
              type: 'shadow'
            },
            axisLine: {
              lineStyle: {
                color: '#666'
              }
            }
          }
        ],
        yAxis: [
          {
            type: 'value',
            name: '万吨标煤',
            min: 0.0,
            max: 50.0,
            interval: 10.0,
            // axisLabel: {
            // formatter: '{value} 吨'
            // },
            axisLine: {
              lineStyle: {
                color: '#666'
              }
            }
          },
          {
            type: 'value',
            name: '吨标煤/万元',
            min: 0.00,
            max: 0.05,
            interval: 0.01,
            // axisLabel: {
            // formatter: '{value} 万元'
            // },
            axisLine: {
              lineStyle: {
                color: '#666'
              }
            }
          }
        ],
        series: [
          {
            name: '实际能源用量',
            type: 'bar',
            data: [19.0, 31.0, 19.0, 29.0, 25.0, 31.0, 20.0, 17.0, 35.0, 31.0, 35.0, 29.0],
            itemStyle: {
              barBorderRadius: [3, 3, 0, 0]
            }
          },
          // {
          //  name: '计划能源用量',
          //  type: 'bar',
          //  data: [28.0, 21.0, 28.0, 28.0, 28.0, 16.0, 28.0, 22.0, 28.0, 21.0, 28.0, 28.0],
          //  itemStyle: {
          //    barBorderRadius: [3, 3, 0, 0]
          //  }
          // },
          {
            name: '上年同期能源用量',
            type: 'bar',
            data: [20.0, 25.0, 22.0, 21.0, 25.0, 27.0, 29.0, 27.0, 20.0, 25.0, 22.0, 21.0],
            itemStyle: {
              barBorderRadius: [3, 3, 0, 0]
            }
          },
          {
            name: '计划节能指标',
            type: 'line',
            yAxisIndex: 1,
            data: [0.005, 0.012, 0.01, 0.012, 0.013, 0.018, 0.016, 0.012, 0.005, 0.012, 0.01, 0.012]
          },
          {
            name: '实际节能指标',
            type: 'line',
            yAxisIndex: 1,
            data: [0.007, 0.009, 0.015, 0.005, 0.007, 0.012, 0.013, 0.019, 0.007, 0.009, 0.015, 0.005]
          }
          // {
          //  name: '上年同期节能指标',
          //  type: 'line',
          //  yAxisIndex: 1,
          //  data: [0.012, 0.013, 0.017, 0.016, 0.018, 0.017, 0.016, 0.015, 0.012, 0.013, 0.017, 0.016]
          // }

        ]
      }

      // 使用刚指定的配置项和数据显示图表。
      this.energyChart.setOption(option, true)
    },
    makeAnalyzeChart() {
      this.analyzeChat = echarts.init(this.$refs.analyze)

      // 指定图表的配置项和数据
      const option = {
        color: ['#00a6fa', '#4dbff3', '#00cf41', '#f75709', '#98d84c', '#0054b4'],
        title: {
          text: '分公司产量占总产量比重',
          x: 'center',
          textStyle: {
            color: '#0965bd'
          }
        },
        tooltip: {
          trigger: 'item',
          formatter: '{b}\n{d}%'
        },
        label: {
          formatter: '{b}\n{d}%'
        },
        series: [
          {
            name: '访问来源',
            type: 'pie',
            radius: ['13%', '70%'],
            center: ['50%', '60%'],
            data: [
              {value: 235, name: '原煤'},
              {value: 274, name: '水'},
              {value: 310, name: '天然气'},
              {value: 168, name: '其他'},
              {value: 335, name: '高温水'},
              {value: 400, name: '电'}
            ],
            roseType: 'angle',
            itemStyle: {
              emphasis: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
              }
            }
          }
        ]
      }

      // 使用刚指定的配置项和数据显示图表。
      this.analyzeChat.setOption(option, true)
    },
    makeDosageChart() {
      this.dosageChat = echarts.init(this.$refs.dosage)

      // 指定图表的配置项和数据
      const option = {
        color: ['#23a9f6'],
        title: {
          text: '能源用量(小时)',
          x: 'center',
          textStyle: {
            color: '#0965bd'
          }
        },
        tooltip: {
          trigger: 'axis',
          axisPointer: {
            type: 'cross',
            label: {
              backgroundColor: '#283b56'
            }
          }
        },
        dataZoom: {
          show: false,
          start: 0,
          end: 100
        },
        xAxis: [
          {
            type: 'category',
            boundaryGap: true,
            axisLine: {
              lineStyle: {
                color: '#666'
              }
            },
            axisLabel: {
              interval: 1
            },
            data: (function () {
              var now = new Date()
              var res = []
              var len = 10
              while (len--) {
                res.unshift(now.toLocaleTimeString().replace(/^\D*/, ''))
                now = new Date(now - 2000)
              }
              return res
            })()
          }
        ],
        yAxis: [
          {
            type: 'value',
            scale: true,
            name: '吨标煤/时',
            max: 30,
            min: 0,
            boundaryGap: [0.2, 0.2],
            axisLine: {
              lineStyle: {
                color: '#666'
              }
            }
          }
        ],
        series: [
          {
            name: '能耗',
            type: 'line',
            areaStyle: {},
            data: (function () {
              var res = []
              var len = 0
              while (len < 10) {
                res.push((Math.random() * 10 + 5).toFixed(1) - 0)
                len++
              }
              return res
            })()
          }
        ]
      }

      clearInterval(this.dossageTimer)
      this.dossageTimer = setInterval(() => {
        let axisData = (new Date()).toLocaleTimeString().replace(/^\D*/, '')

        var data0 = option.series[0].data
        data0.shift()
        data0.push((Math.random() * 10 + 5).toFixed(1) - 0)

        option.xAxis[0].data.shift()
        option.xAxis[0].data.push(axisData)

        this.dosageChat.setOption(option, true)
      }, 2100)

      // 使用刚指定的配置项和数据显示图表。
      this.dosageChat.setOption(option, true)
    },
    makeCostChart() {
      this.costChat = echarts.init(this.$refs.cost)

      // 指定图表的配置项和数据
      const option = {
        color: ['#095db1'],
        title: {
          text: '能源费用(小时)',
          x: 'center',
          textStyle: {
            color: '#0965bd'
          }
        },
        tooltip: {
          trigger: 'axis',
          axisPointer: {
            type: 'cross',
            label: {
              backgroundColor: '#283b56'
            }
          }
        },
        dataZoom: {
          show: false,
          start: 0,
          end: 100
        },
        xAxis: {
          type: 'category',
          boundaryGap: true,
          axisLine: {
            lineStyle: {
              color: '#666'
            }
          },
          axisLabel: {
            interval: 1
          },
          data: (function () {
            var now = new Date()
            var res = []
            var len = 10
            while (len--) {
              res.unshift(now.toLocaleTimeString().replace(/^\D*/, ''))
              now = new Date(now - 2000)
            }
            return res
          })()
        },
        yAxis: {
          type: 'value',
          scale: true,
          name: '万元/时',
          max: 1200,
          min: 0,
          boundaryGap: [0.2, 0.2],
          axisLine: {
            lineStyle: {
              color: '#666'
            }
          }
        },
        series: [
          {
            name: '费用',
            type: 'bar',
            itemStyle: {
              barBorderRadius: [3, 3, 0, 0]
            },
            data: (function () {
              var res = []
              var len = 10
              while (len--) {
                res.push(Math.round(Math.random() * 1000))
              }
              return res
            })()
          }
        ]
      }
      clearInterval(this.costTimer)
      this.costTimer = setInterval(() => {
        var axisData = (new Date()).toLocaleTimeString().replace(/^\D*/, '')
        var data0 = option.series[0].data
        data0.shift()
        data0.push(Math.round(Math.random() * 1000))

        option.xAxis.data.shift()
        option.xAxis.data.push(axisData)

        this.costChat.setOption(option, true)
      }, 2100)

      // 使用刚指定的配置项和数据显示图表。
      this.costChat.setOption(option, true)
    },
    toggleCard() {
      if (this.flipData.length === 0) {
        this.flipData.push(0)
      } else {
        this.flipData.push(Math.round(Math.random() * 1000))
      }
      clearTimeout(this.toggleCartTimer)
      this.toggleCartTimer = setTimeout(() => {
        this.toggleCard()
      }, 4000)
    },
    refreshChart() {
      this.energyChart.resize()
      this.analyzeChat.resize()
      this.dosageChat.resize()
      this.costChat.resize()
    }
  },
  mounted() {
    this.makeEnergyChart()
    this.makeAnalyzeChart()
    this.makeDosageChart()
    this.makeCostChart()
    this.toggleCard()
    window.addEventListener('resize', () => {
      clearTimeout(this.resizeTimer)
      this.resizeTimer = setTimeout(() => {
        this.refreshChart()
      }, 60)
    })
  }
}
</script>
<style scoped lang="stylus">
  @import "~common/stylus/variable.styl"
  @import "~common/stylus/mixin.styl"
  .home-container
    overflow: hidden
    position: absolute
    top: 0
    left: 0
    right: 0
    bottom: 0
    .home
      background: $color-sub-text
      display: flex
      flex-direction: column
      min-height: 100%
      .panels
        .panel-l
          border-top: 3px solid $color-sub-text
          border-left: 3px solid $color-sub-text
        .panel-r
          border-top: 3px solid $color-sub-text
          border-right: 3px solid $color-sub-text
        .panel-l,.panel-r
          display: flex
          flex-direction: column
          .title
            text-align: center
            height: 50px
            line-height: 50px
            background: $color-background
            border: 3px solid $color-sub-text
            border-radius: 5px
            cursor: pointer
            &.xiazuan:hover
              color: #fc3507
          .panel
            flex: 1
            .panel-item
              border-radius: 5px
              border: 3px solid $color-sub-text
              box-sizing: border-box
              cursor: pointer
              background: $color-background
              color: $color-text
              padding: 5px
              box-sizing: border-box
              height: 100%
              display: flex
              flex-direction: column
              .row
                flex: 1
                display: flex
                align-items: center
                &.xiazuan:hover
                  color: #fc3507
                .row-item
                  min-height: 35px
                  display: flex
                  align-items: center
                  .big
                    font-size: $font-size-large-x-x
                    color: $color-theme
                  .big2
                    font-size: $font-size-large-x
                  .down
                    color: #08ae5e
                  .up
                    color: #ef3d14
              .subtitle
                color: #ffffff
      .real-time
        .dosage
          border: 3px solid $color-sub-text
          border-left: 6px solid $color-sub-text
          min-height: 250px
          display: flex
          background: $color-background
          padding: 5px
          border-radius: 5px
          justify-content: flex-start
        .cost
          border: 3px solid $color-sub-text
          border-right: 6px solid $color-sub-text
          min-height: 250px
          display: flex
          background: $color-background
          padding: 5px
          border-radius: 5px
          justify-content: flex-end
      .chart
        flex: 1
        .energy
          border-top: 3px solid $color-sub-text
          border-bottom: 6px solid $color-sub-text
          border-left: 6px solid $color-sub-text
          border-right: 3px solid $color-sub-text
          min-height: 250px
          height: 100%
          display: flex
          background: $color-background
          padding: 5px
          border-radius: 5px
          justify-content: flex-start
        .analyze
          border-top: 3px solid $color-sub-text
          border-bottom: 6px solid $color-sub-text
          border-left: 3px solid $color-sub-text
          border-right: 6px solid $color-sub-text
          display: flex
          background: $color-background
          padding: 5px
          border-radius: 5px
          justify-content: flex-start
          height: 100%
          min-height: 250px
</style>
